---
// src/layouts/Layout.astro
import Footer from "../components/Footer.astro";
import AdsInjector from "../components/AdsInjector.astro";
const { title = "", description, img, ogImage } = Astro.props;
import "../../css/style.css";

// Ù„Ùˆ Ù…ÙÙŠØ´ ogImage â†’ Ù†Ø³ØªØ®Ø¯Ù… img
const makeAbsolute = (url: string = ""): string =>
  url.startsWith("http") ? url : `https://lolme.cc${url}`;

const finalOg = makeAbsolute(ogImage || img || "/images/default-og.webp");


// ØªØ¹Ø±ÙŠÙ Ø§Ù„ØªØ±Ø¬Ù…Ø©
const translations = {
  ar: { home: "ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", articles: "ğŸ“š Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª" },
  en: { home: "ğŸ  Home", articles: "ğŸ“š Articles" },
} as const;

// Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù„ØºØ© Ù…Ù† Ø§Ù„ÙƒÙˆÙƒÙŠØ² (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©)
let lang: "ar" | "en" =
  (Astro.cookies.get("lang")?.value as "ar" | "en") || "ar";
---

<html lang={lang} dir={lang === "ar" ? "rtl" : "ltr"}>
<!-- <html > -->
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- OG + TWITTER tags Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ†ÙˆØ§ Ù‡Ù†Ø§ -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description || "Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø´Ø®ØµÙŠØ© Ù…Ø¶Ø­ÙƒØ©ØŒ Ù…ÙŠÙ…Ø² ÙŠÙˆÙ…ÙŠØ©ØŒ Ù†ÙƒØªØŒ Ø£ÙØ´Ø§ØªØŒ Ø±ÙˆØ³Øª ØµØ§Ø­Ø¨ÙƒØŒ Ø£Ù„Ø¹Ø§Ø¨ Ø£Ø³Ø¦Ù„Ø©ØŒ ÙˆÙ…Ø­ØªÙˆÙ‰ ØªØ±ÙÙŠÙ‡ÙŠ Ø³Ø±ÙŠØ¹. Ù„ÙˆÙ„ Ù…ÙŠ â€“ Ø£ÙƒØ¨Ø± Ù…Ù†ØµØ© Ø¹Ø±Ø¨ÙŠØ© Ù„Ù„Ø¶Ø­Ùƒ ÙˆØ§Ù„ØªØ³Ù„ÙŠØ© ÙˆØ§ÙƒØªØ´Ø§Ù Ø´Ø®ØµÙŠØªÙƒ! ğŸ˜‚ğŸ”¥"} />
    <!-- <meta property="og:image" content={Astro.props.ogImage || "https://lolme.cc/images/default-og.webp"} /> -->
    <meta property="og:image" content={finalOg} />
    <meta property="og:url" content={`https://lolme.cc${Astro.url.pathname}`} />
    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta property="og:description" content={description || "Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø´Ø®ØµÙŠØ© Ù…Ø¶Ø­ÙƒØ©ØŒ Ù…ÙŠÙ…Ø² ÙŠÙˆÙ…ÙŠØ©ØŒ Ù†ÙƒØªØŒ Ø£ÙØ´Ø§ØªØŒ Ø±ÙˆØ³Øª ØµØ§Ø­Ø¨ÙƒØŒ Ø£Ù„Ø¹Ø§Ø¨ Ø£Ø³Ø¦Ù„Ø©ØŒ ÙˆÙ…Ø­ØªÙˆÙ‰ ØªØ±ÙÙŠÙ‡ÙŠ Ø³Ø±ÙŠØ¹. Ù„ÙˆÙ„ Ù…ÙŠ â€“ Ø£ÙƒØ¨Ø± Ù…Ù†ØµØ© Ø¹Ø±Ø¨ÙŠØ© Ù„Ù„Ø¶Ø­Ùƒ ÙˆØ§Ù„ØªØ³Ù„ÙŠØ© ÙˆØ§ÙƒØªØ´Ø§Ù Ø´Ø®ØµÙŠØªÙƒ! ğŸ˜‚ğŸ”¥"} />
    <!-- <meta name="twitter:image" content={Astro.props.ogImage || "https://lolme.cc/images/default-og.webp"} /> -->
<meta name="twitter:image" content={finalOg} />
<meta name="mylead-verification" content="71d6df0ab7b92b5fe986e8cae0205e5f">

    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" type="image/png" href="/favicon64.png" />
    <meta name="theme-color" content="#1f8ef1" />
    <!-- Ø¶Ø±ÙˆØ±ÙŠ HTTPS Ø¹Ù„Ø´Ø§Ù† ÙŠØ¸Ù‡Ø± Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª -->
    <script src="/js/ad-close.js" defer></script>

    <script type="module" src="/js/register-sw.js"></script>
    <!-- <script type="module" src="/js/lang.js"></script> -->

    <!-- Ø®Ø·ÙˆØ· Ø¬ÙˆØ¬Ù„ -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Changa&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Reem+Kufi&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Marhey&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Impact&display=swap" rel="stylesheet" />

    <title>{title}</title>
    <meta name="description" content={description} />
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9947408531248001"
    crossorigin="anonymous"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-98W71513M3"></script>
    <script type="module" src="/js/googletagmanager.js"></script>

  </head>
  <body>

    <script>
      (function () {
        const saved = localStorage.getItem("lang") || "ar";
        document.documentElement.lang = saved;
        document.documentElement.dir = saved === "ar" ? "rtl" : "ltr";
      })();

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker
            .register('/service-worker.js')
            .then(() => console.log('âœ… Service Worker registered'))
            .catch(err => console.error('âŒ SW registration failed:', err));
        });
      }
    </script>
    

    <!-- <slot /> -->
    <main>
  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø«Ø§Ø¨Øª -->
  <header class="page-header" style="display:flex;justify-content:space-around;align-items:center;width:94%;padding:0rem 1rem;background:#0000;">     
        <nav class="header-nav">
          <a id="nav-home" href="/">{translations[lang].home}</a>
          <span class="divider">|</span>
          <a id="nav-articles" href="/articles">{translations[lang].articles}</a>

          <span id="toggle-theme" style="cursor:pointer; font-size:1.5rem;">ğŸŒ™</span>

        </nav>
    
    </nav>
    <div class="header-left">
      <img src="/favicon.png" alt="LOLME" class="logo" style="margin-bottom: -5px;"/>
    </div>
  </header>

  <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  {Astro.props.title && (
    <div class="page-title">
      <h1>{Astro.props.title}</h1>
      {Astro.props.description && (
        <p class="description">{Astro.props.description}</p>
      )}
    </div>
  )}

{img && (
  <div style="text-align:center; margin: 20px auto;">
    <img 
      src={img} 
      alt={title} 
      style="
        max-width: 600px; 
        width: 90%; 
        border-radius: 14px; 
        box-shadow: 0 6px 15px rgba(0,0,0,0.15);
      "
      class="tilt-card"
    />
  </div>
)}

    <!-- Ø¥Ø¹Ù„Ø§Ù† ÙÙˆÙ‚ -->
    <!-- <AdsInjector showTop={true} showSide={true} showFloating={true} showBottom={false} /> -->

    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© -->
    <div class="page-content article">
      <slot />
    </div>

    <!-- Ø¥Ø¹Ù„Ø§Ù† ØªØ­Øª -->
    <!-- <AdsInjector showTop={false} showSide={false} showFloating={false} showBottom={true} /> -->

    </main>
    <!-- <div class="ad-space">Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© Ù‡Ù†Ø§</div> -->

    <Footer />
    <script type="module">
      document.addEventListener("DOMContentLoaded", () => {
        const themeToggle = document.getElementById("toggle-theme");
        if (!themeToggle) return; // Ù„Ùˆ Ø§Ù„Ø¹Ù†ØµØ± Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø®Ø±Ø¬
    
        function applyTheme(theme) {
          if(theme === "light") {
            document.body.classList.add("light-theme");
            themeToggle.textContent = "ğŸŒ";
          } else {
            document.body.classList.remove("light-theme");
            themeToggle.textContent = "ğŸŒ™";
          }
        }
    
        const savedTheme = localStorage.getItem("theme") || "dark";
        applyTheme(savedTheme);
    
        themeToggle.addEventListener("click", () => {
          const newTheme = document.body.classList.contains("light-theme") ? "dark" : "light";
          applyTheme(newTheme);
          localStorage.setItem("theme", newTheme);
        });
      });
    </script>
    
  </body>
</html>

<style>
  .page-title {
    max-width: 1000px;      /* Ù†ÙØ³ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚Ø§Ù„ */
    margin: 20px auto;       /* ÙŠØ³Ù†ØªØ± Ø§Ù„Ù€ div Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© */
    text-align: center;      /* ÙŠØ³Ù†ØªØ± Ø§Ù„Ù†ØµÙˆØµ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ div */
    padding: 0 15px;         /* Ù…Ø³Ø§ÙØ© Ø¯Ø§Ø®Ù„ÙŠØ© Ø¨Ø³ÙŠØ·Ø© */
  }

  .page-title h1 {
    font-size: 2rem;
    margin-bottom: 10px;
  }

  .page-title .description {
    font-size: 1.1rem;
    color: var(--accent-color);
    line-height: 1.6;
  }

</style>