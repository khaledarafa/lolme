---
// funnyImages.astro
export const prerender = false;
import Layout from "../layouts/Layout.astro";
import memes from "../data/memes-captions.json";
const siteEmoji = "/images/site-emoji.png";
---

<Layout>
  <h2 class="accordion"> Ù…Ø±Ø¨Ø¹Ø§Øª Ù…ÙŠÙ…Ø² Ù…Ø¶Ø­ÙƒØ© Ø¹Ù† Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª <img src={siteEmoji} class="emoji-icon" alt="site emoji" /> </h2>
  <div class="panel">
    <div class="memes-grid">
      {
        memes.animals.map((meme, index) => (
          <div class="meme-card cards tilt-card">
            <span class="meme-number">{index + 1}</span>
            <img src={meme.src} alt={`Meme ${index + 1}`} />
            <>
              <p>{meme.caption}</p>
              <button class="download-btn">ØªØ­Ù…ÙŠÙ„</button>
              <button class="share-btn" onclick={`shareMeme('${meme.src}', '${meme.caption.replace(/'/g, "\\'")}')`}>Ø´Ø§Ø±Ùƒ Ø§Ù„ØµÙˆØ±Ø© ğŸ“²</button>
            </>
          </div>
        ))
      }
    </div>
  </div>
  
  <h2 class="accordion"> Ù…Ø±Ø¨Ø¹Ø§Øª Ù…ÙŠÙ…Ø² Ù…Ø¶Ø­ÙƒØ© Ø¹Ù† Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© <img src={siteEmoji} class="emoji-icon" alt="site emoji" /> </h2>
  <div class="panel">
    <div class="memes-grid">
      {
        memes.daily.map((meme, index) => (
          <div class="meme-card cards tilt-card">
            <span class="meme-number">{index + 1}</span>
            <img src={meme.src} alt={`Meme ${index + 1}`} />
            <>
              <p>{meme.caption}</p>
              <button class="download-btn">ØªØ­Ù…ÙŠÙ„</button>
              <button class="share-btn" onclick={`shareMeme('${meme.src}', '${meme.caption.replace(/'/g, "\\'")}')`}>Ø´Ø§Ø±Ùƒ Ø§Ù„ØµÙˆØ±Ø© ğŸ“²</button>
            </>
          </div>
        ))
      }
    </div>
  </div>
  
  <h2 class="accordion"> Ù…Ø±Ø¨Ø¹Ø§Øª Ù…ÙŠÙ…Ø² Ù…Ø¶Ø­ÙƒØ© Ø¹Ù† Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ <img src={siteEmoji} class="emoji-icon" alt="site emoji" /> </h2>
  <div class="panel">
    <div class="memes-grid">
      {
        memes.friends.map((meme, index) => (
          <div class="meme-card cards tilt-card">
            <span class="meme-number">{index + 1}</span>
            <img src={meme.src} alt={`Meme ${index + 1}`} />
            <>
              <p>{meme.caption}</p>
              <button class="download-btn">ØªØ­Ù…ÙŠÙ„</button>
              <button class="share-btn" onclick={`shareMeme('${meme.src}', '${meme.caption.replace(/'/g, "\\'")}')`}>Ø´Ø§Ø±Ùƒ Ø§Ù„ØµÙˆØ±Ø© ğŸ“²</button>
            </>
          </div>
        ))
      }
    </div>
  </div>
  
  <h2 class="accordion"> Ù…Ø±Ø¨Ø¹Ø§Øª Ù…ÙŠÙ…Ø² Ù…Ø¶Ø­ÙƒØ© Ø¹Ù† Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª <img src={siteEmoji} class="emoji-icon" alt="site emoji" /> </h2>
  <div class="panel">
    <div class="memes-grid">
      {
        memes.relations.map((meme, index) => (
          <div class="meme-card cards tilt-card">
            <span class="meme-number">{index + 1}</span>
            <img src={meme.src} alt={`Meme ${index + 1}`} />
            <>
              <p>{meme.caption}</p>
              <button class="download-btn">ØªØ­Ù…ÙŠÙ„</button>
              <button class="share-btn" onclick={`shareMeme('${meme.src}', '${meme.caption.replace(/'/g, "\\'")}')`}>Ø´Ø§Ø±Ùƒ Ø§Ù„ØµÙˆØ±Ø© ğŸ“²</button>
            </>
          </div>
        ))
      }
    </div>
  </div>
</Layout>

<script type="module">
  import { initDownloadMeme } from "../js/memes-client.js";
  if (typeof window !== "undefined") {
    window.addEventListener("DOMContentLoaded", () => {
      initDownloadMeme();

      // Ø§Ù„ÙƒÙˆØ¯ Ø¨ØªØ§Ø¹ Ø§Ù„Ù€ accordion
      const accordions = document.querySelectorAll(".accordion");
      accordions.forEach((acc) => {
        acc.addEventListener("click", () => {
          const panel = acc.nextElementSibling;
          if (panel.style.maxHeight) panel.style.maxHeight = null;
          else panel.style.maxHeight = panel.scrollHeight + "px";
        });
      });
    });
  }
</script>
<!-- <script is:inline>
  window.addEventListener("DOMContentLoaded", () => {

    window.shareMeme = async (imgSrc, caption) => {
      try {
        const fullUrl = window.location.origin + imgSrc;

        // 1) Ù†Ø¬ÙŠØ¨ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.src = fullUrl;

        img.onload = async () => {
          
          // 2) Ù†Ø¹Ù…Ù„ Canvas Ø¨Ù†ÙØ³ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø©
          const canvas = document.createElement("canvas");
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext("2d");

          // 3) Ù†Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
          ctx.drawImage(img, 0, 0);

          // 4) Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© (Ù„ÙˆØ¬Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹)
          ctx.font = "40px Cairo, sans-serif";
          ctx.fillStyle = "rgba(255,255,255,0.75)";
          ctx.textAlign = "right";
          ctx.fillText("lolme.cc ğŸ˜‚ğŸ”¥", canvas.width - 30, canvas.height - 30);

          // 5) Ù†Ø­ÙˆÙ„ Ø§Ù„ÙƒØ§Ù†ÙØ³ Ù„Ø¨Ù„ÙˆØ¨
          canvas.toBlob(async (blob) => {
            const file = new File([blob], "meme.png", { type: "image/png" });

            const shareData = {
              title: "Ù…ÙŠÙ… Ù…Ø¶Ø­Ùƒ ğŸ˜‚ğŸ”¥",
              text: caption + "\nâ€” Ù…Ù† Ù„ÙˆÙ„ Ù…ÙŠ",
              files: [file],
            };

            if (navigator.canShare && navigator.canShare(shareData)) {
              await navigator.share(shareData);
            } else {
              // fallback
              await navigator.share({
                title: "Ù…ÙŠÙ… Ù…Ø¶Ø­Ùƒ",
                text: caption + "\nØ´ÙˆÙ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§: " + fullUrl,
              });
            }
          }, "image/png");
        };

        img.onerror = () => alert("Ø­ØµÙ„ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© ğŸ’”");

      } catch (err) {
        console.log("âŒ Ø§Ù„Ø´ÙŠØ± Ø§ØªÙ„ØºÙ‰ Ø£Ùˆ Ø­ØµÙ„ Ø®Ø·Ø£:", err);
      }
    };

  });
</script> -->

<script is:inline>
  window.addEventListener("DOMContentLoaded", () => {

    window.shareMeme = async (imgSrc, caption) => {
      try {
        const fullUrl = window.location.origin + imgSrc;
        const logoUrl = "/favicon.png";

        // Ù†Ø­Ù…Ù„ Ø§Ù„ØµÙˆØ±Ø©
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.src = fullUrl;

        // Ù†Ø­Ù…Ù„ Ø§Ù„Ù„ÙˆØ¬Ùˆ (Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ)
        const logo = new Image();
        logo.crossOrigin = "anonymous";
        logo.src = logoUrl;

        img.onload = () => {
          logo.onload = async () => {

            // Ù†Ø¹Ù…Ù„ ÙƒØ§Ù†ÙØ³ Ø¨Ù†ÙØ³ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø©
            const canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext("2d");

            // Ù†Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
            ctx.drawImage(img, 0, 0);

            const padding = 30;
            const fontSize = Math.floor(canvas.width * 0.045); 
            ctx.font = `${fontSize}px Arial`;
            ctx.fillStyle = "white";
            ctx.strokeStyle = "black";
            ctx.lineWidth = 4;
            ctx.textBaseline = "middle";

            const text = "lolme.cc";
            const textWidth = ctx.measureText(text).width;

            // Ø­Ø¬Ù… Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø¬Ù†Ø¨ Ø§Ù„Ù†Øµ
            const logoSize = fontSize + 10;

            // Ù…ÙƒØ§Ù† Ø§Ù„Ø±Ø³Ù… (ÙŠÙ…ÙŠÙ† ØªØ­Øª)
            const x = canvas.width - textWidth - logoSize - padding - 20;
            const y = canvas.height - padding;

            // Ù†Ø±Ø³Ù… Ø§Ù„Ù†Øµ Ø¨Ø¸Ù„ Ø¨Ø³ÙŠØ·
            ctx.strokeText(text, x, y);
            ctx.fillText(text, x, y);

            // Ù†Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© Ø¬Ù†Ø¨ Ø§Ù„Ù†Øµ
            ctx.drawImage(
              logo,
              x + textWidth + 10,
              y - logoSize / 2,
              logoSize,
              logoSize
            );

            // Ù†Ø­ÙˆÙ„ Ø§Ù„ÙƒØ§Ù†ÙØ³ Ø¥Ù„Ù‰ ØµÙˆØ±Ø©
            canvas.toBlob(async (blob) => {
              const file = new File([blob], "meme.png", { type: "image/png" });

              const shareData = {
                title: "Ù…ÙŠÙ… Ù…Ø¶Ø­Ùƒ ğŸ˜‚ğŸ”¥",
                text: caption + "\nâ€” Ù…Ù† Ù„ÙˆÙ„ Ù…ÙŠ",
                files: [file],
              };

              if (navigator.canShare && navigator.canShare(shareData)) {
                await navigator.share(shareData);
              } else {
                await navigator.share({
                  title: "Ù…ÙŠÙ… Ù…Ø¶Ø­Ùƒ",
                  text: caption + "\nØ´ÙˆÙ Ø§Ù„Ù…ÙŠÙ… Ù‡Ù†Ø§:\n" + fullUrl,
                });
              }
            }, "image/png");
          };
        };

      } catch (err) {
        console.log("âŒ Ø§Ù„Ø´ÙŠØ± Ø§ØªÙ„ØºÙ‰ Ø£Ùˆ Ø­ØµÙ„ Ø®Ø·Ø£:", err);
      }
    };

  });
</script>

<script type="module" src="/js/tilt-cards.js"></script>
<style>
  .meme-number {
    font-weight: bold;
    display: block;
    margin-bottom: 0.3rem;
    color: var(--text-color, #000);
  }
  .accordion {
    cursor: pointer;
    padding: 1rem;
    background: var(--card);
    border-radius: 10px;
    margin-bottom: 0.5rem;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .funny-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 2rem 0;
  }

  .funny-card {
    background: var(--card);
    padding: rem;
    border-radius: 10px;
    box-shadow: 0 2px 5px var(--shadow-color);
    text-align: center;
  }

  .funny-card img {
    width: 100%;
    border-radius: 10px;
    margin-bottom: 0.5rem;
  }

  .funny-card p {
    font-size: 1rem;
    color: var(--text-color);
  }
  .memes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1rem;
    padding: 1rem;
  }

  .panel {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .meme-card img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 10px;
  }
  .cards {
    font-size: 1.2rem;
    margin-bottom: 0.2rem;
    color: var(--text-color, #000); /* fallback Ù„Ùˆ Ø§Ù„Ù…ØªØºÙŠØ± Ù…Ø´ Ù…ØªØ¹Ø±Ù */
    background: var(--card, #fff); /* fallback Ù„Ù„ÙˆÙ† Ø£Ø¨ÙŠØ¶ */
    padding: 0.5rem 0.5rem; /* Ù…Ø³Ø§ÙØ© Ø¯Ø§Ø®Ù„ÙŠØ© ØªØ®Ù„ÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ¸Ù‡Ø± */
    border-radius: 10px; /* Ø­ÙˆØ§Ù Ù…Ø¯ÙˆØ±Ø© */
    box-shadow: 0 1px 1px var(--shadow-color); /* Ø¸Ù„ Ø®ÙÙŠÙ ÙŠØ¸Ù‡Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
  }
  .meme-card .caption-overlay {
    position: absolute;
    bottom: 0;
    right: 0; /* Ø§Ù„Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ© */
    width: 100%;
    background: rgba(0, 0, 0, 0.5);
    color: white;
    padding: 5px 10px;
    font-weight: bold;
    text-align: right;
  }
</style>
