---
// src/pages/index.astro
export const prerender = false;
import Layout from "../layouts/Layout.astro";

interface ArticleFrontmatter {
  title: string;
  description?: string;
  image?: string;
  date?: string;
}

interface ArticleWithSlug extends ArticleFrontmatter {
  slug: string;
}

// load *frontmatter only* without eager or loading images/components
const modules = import.meta.glob("./articles/*.astro", {
  import: "frontmatter",
});

const articles: ArticleWithSlug[] = [];

for (const [path, loader] of Object.entries(modules)) {
  const fm = await loader() as ArticleFrontmatter;

  if (path.endsWith("index.astro")) continue;

  articles.push({
    slug: path.replace("./articles/", "").replace(".astro", ""),
    title: fm.title,
    description: fm.description ?? "",
    image: fm.image ?? "/images/default-article.webp",
    date: fm.date ?? "2000-01-01",
  });
}

articles.sort((a, b) => {
  const da = new Date(a.date ?? "2000-01-01").getTime();
  const db = new Date(b.date ?? "2000-01-01").getTime();
  return db - da;
});

const latestArticles: ArticleWithSlug[] = articles.slice(0, 5);

// home buttons
const homeButtons = [
  { title: "ğŸ”® Ø¥Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø¶Ø­ÙƒØ©", slug: "/tests", img: "/images/tests.webp" },
  { title: "ğŸ¤£ Ù†ÙƒØª Ù…Ø¶Ø­ÙƒØ©", slug: "/jokes", img: "/images/jokes.webp" },
  { title: "ğŸ“¸ Ø§Ø¹Ù…Ù„ Ù…ÙŠÙ…ÙŠØ² Ø¯Ù„ÙˆÙ‚ØªÙŠ", slug: "/meme", img: "/images/meme.webp" },
  { title: "ğŸ”¥ Ø±ÙˆÙ‘Ø³Øª ØµØ§Ø­Ø¨Ùƒ", slug: "/roast", img: "/images/roast.webp" },
  { title: "ğŸ¤£ ØµÙˆØ± Ù…Ø¶Ø­ÙƒØ©", slug: "/funnyImages", img: "/images/funny.webp" },
  { title: "Ø­ÙˆÙ‘Ù„ PDF Ø¥Ù„Ù‰ ØµÙˆØ± ğŸ¤¯", slug: "/pdf-to-images", img: "/images/pdf2imgs.webp" },
];
---

<Layout title="ğŸ¤£ LOLME">

  <section style="text-align:center; padding: 0px 0.1rem;">
    <p style="margin: 0px;"> Ø£Ø¯ÙˆØ§Øª ØªØ±ÙÙŠÙ‡ÙŠØ© Ù‡Ø§ÙŠÙØ© ÙˆÙ…Ø¬Ù†ÙˆÙ†Ø© ğŸ•ºğŸ”¥</p>
    <p> LOLME Ù‡Ùˆ Ù…ÙƒØ§Ù†Ùƒ Ù„Ù„Ø¶Ø­Ùƒ ÙˆØ§Ù„Ù‡Ø²Ø§Ø±! Ø§Ø±ÙØ¹ ØµÙˆØ±Ø©ØŒ Ø§ÙƒØªØ¨ Ù…ÙŠÙ…Ø²ØŒ ÙˆØ±ÙˆÙ‘Ø³Øª Ø£ØµØ­Ø§Ø¨Ùƒ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ø±Ø­Ø© ğŸ˜ </p>
    <button id="install-btn" class="appbtn">â¬‡ï¸ Ø­Ù…Ù‘Ù„ LOLME ÙƒØªØ·Ø¨ÙŠÙ‚</button>
  </section>

  <div class="imojidiv">
    <div class="emoji" style="font-size:2rem;">ğŸ¤£</div>
    <div class="emoji" style="left:20%;">ğŸ¤£</div>
    <div class="emoji" style="left:35%;">ğŸ˜‚</div>
    <div class="emoji" style="left:50%;">ğŸ˜</div>
    <div class="emoji" style="left:65%;">ğŸ¥³</div>
    <div class="emoji" style="left:80%;">ğŸ¤ª</div>
    <div class="emoji" style="font-size:2rem;">ğŸ¥³</div>
  </div>

  <!-- â­ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© -->
  <h2 style="text-align:center; margin:25px 0;">ğŸ”® Ø£Ø¯ÙˆØ§Øª Ù„ÙˆÙ„ Ù…ÙŠ</h2>

  <main class="home-grid">
    {homeButtons.map((btn, i) => (
      <a href={btn.slug} class="home-card tilt-card">
        <img 
          src={btn.img} 
          alt={btn.title}
          width="350"
          height="200"
          loading={i === 0 ? "eager" : "lazy"}
          fetchpriority={i === 0 ? "high" : "auto"}
          style="object-fit:cover;"
        />    
        <div class="content">
          <h3>{btn.title}</h3>
        </div>
      </a>
    ))}
  </main>

  <section>
    <h2>ğŸ“° Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</h2>
    <div class="articles-grid">
      {latestArticles.map(article => (
        <a href={`/articles/${article.slug}`} class="article-card tilt-card">
          <img 
            src={article.image} 
            alt={article.title} 
            width="350" 
            height="200" 
            loading="lazy" 
            style="object-fit:cover;" 
          />
          <h3>{article.title}</h3>
          <p>{article.description}</p>
        </a>
      ))}
    </div>
  </section>

  <script src="/js/install-btn.js" defer></script>
  <script src="/js/open-meme.js"   defer></script>
  <script src="/js/tilt-cards.js"  defer></script>

</Layout>

<style>
  .home-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
    max-width: 1000px;
    margin: auto;
    padding: 40px 8px;
  }

  .home-card {
    text-decoration: none;
    color: inherit;
    background: var(--bg-color);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 10px var(--shadow-color);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .home-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 10px rgb(241, 249, 16);
  }

  .home-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
  }

  .home-card .content {
    padding: 10px;
    text-align: center;
  }

  .home-card h3 {
    font-size: 1.1rem;
    margin: 0;
    color: var(--accent);
  }

  .appbtn {
    background: transparent;
    color: var(--accent);
    padding: 10px 20px;
    font-size: 1rem;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
  }

  .tilt-card, .tilt-card .product-card-inner {
    will-change: transform, box-shadow;
    transform-origin: center;
  }

/* =============== articles =============== */
.articles-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin: 20px 0;
}
.article-card {
  display: flex;
  flex-direction: column;
  background: var(--bg-color);
  border-radius: 8px;
  overflow: hidden;
  text-decoration: none;
  color: inherit;
  box-shadow: 0 4px 10px var(--shadow-color);
  transition: transform 0.2s;
}
.article-card:hover { transform: translateY(-3px); }
.article-card img { width: 100%; height: 150px; object-fit: cover; }
.article-card h3 { margin: 10px; font-size: 1.1rem; }
.article-card p { margin: 0 10px 10px; font-size: 0.9rem; color: var(--text-muted); }
</style>